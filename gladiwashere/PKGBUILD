developer=http://indiebox.net/
maintainer=${developer}
pkgname=$(basename $(pwd))
pkgver=0.4
pkgrel=1
pkgdesc="Best Guestbook Evar"
arch=('any')
url="http://indiebox.net/"
license=('GPL')
groups=()
depends=()
backup=()
source=()
options=('!strip')
_parameterize=$(cat <<END
    s!##pkgname##!$pkgname!g;
    s!##pkgdesc##!$pkgdesc!g;
    s!##developer##!$developer!g;
    s!##maintainer##!$maintainer!g;
    s!##pkgver##!$pkgver!g;
    s!##pkgrel##!$pkgrel!g;
    s!##license##!$license!g;
END
)
package() {
# Manifest
    mkdir -p $pkgdir/var/lib/indiebox/manifests
    perl -pe "$_parameterize" $startdir/indiebox-manifest.json > $pkgdir/var/lib/indiebox/manifests/${pkgname}.json
    chmod 0644 $pkgdir/var/lib/indiebox/manifests/${pkgname}.json

# Icons
    mkdir -p $pkgdir/srv/http/_appicons/${pkgname}
    install -m644 $startdir/appicons/{72x72,144x144}.png $pkgdir/srv/http/_appicons/$pkgname/
    install -m644 $startdir/appicons/license.txt $pkgdir/srv/http/_appicons/$pkgname/

# Code
    mkdir -p $pkgdir/usr/share/${pkgname}/web
    install -m755 $startdir/web/{index,gladiwashere}.php  $pkgdir/usr/share/${pkgname}/web/

    mkdir -p $pkgdir/usr/share/${pkgname}/tmpl
    install -m755 $startdir/tmpl/config.php.tmpl $pkgdir/usr/share/${pkgname}/tmpl/

    mkdir -p $pkgdir/usr/share/${pkgname}/sql
    install -m755 $startdir/sql/create.sql $pkgdir/usr/share/${pkgname}/sql/
}
